{{define "body"}}
<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
    <h1 class="page-header">Lab 1 – Clone Phishing</h1>
    <div id="flashes" class="row"></div>

    <!-- Screen 1: Email view -->
    <div id="lab-email-screen">
        <div class="row">
            <div class="col-lg-7">
                <div class="panel panel-default">
                    <div class="panel-heading"><strong>Phishing Email</strong></div>
                    <div class="panel-body">
                        <p class="text-muted">
                            Inspect the sender and the content of this email. Then click
                            <strong>View Salary Statement</strong> to continue.
                        </p>

                        <div class="well">
                            <p><strong>Subject:</strong> Salary Statement for This Month Available</p>
                            <p><strong>From:</strong> HR Department &lt;hr-payroll@acmecorp-pay.com&gt;</p>
                            <p><strong>To:</strong> you@acmecorp.com</p>
                            <hr>
                            <p>Dear Employee,</p>
                            <p>
                                Your monthly salary statement has been generated. For security reasons,
                                you are required to log in to the HR Portal to view and download your statement.
                            </p>
                            <p>Please click the button below to securely access your salary details:</p>
                            <button class="btn btn-primary" id="openCloneBtn">
                                View Salary Statement
                            </button>
                            <p class="m-t-md">
                                Regards,<br>
                                HR &amp; Payroll Team<br>
                                Acme Corp
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Task panel for step 1 -->
            <div class="col-lg-5">
                <div class="panel panel-info">
                    <div class="panel-heading"><strong>Task Panel – Step 1</strong></div>
                    <div class="panel-body">
                        <p><strong>Task 1 – Inspect the sender</strong></p>
                        <p class="small">
                            Look carefully at the <code>From</code> email address. Does the domain belong to the
                            official company (<code>acmecorp.com</code>) or is it slightly different?
                        </p>
                        <p class="small">
                            The attacker uses a look-alike domain:
                            <code>acmecorp-pay.com</code>.
                        </p>
                        <p class="small">
                            Suggested flag format:
                            <code>FLAG{suspicious-sender}</code>
                        </p>
                        <hr>
                        <p class="small">
                            When ready, click <strong>View Salary Statement</strong> to open the cloned login page.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Screen 2: Cloned login page -->
    <div id="lab-login-screen" style="display:none;">
        <div class="row">
            <div class="col-lg-7">
                <div class="panel panel-default">
                    <div class="panel-heading"><strong>Cloned HR Login Page</strong></div>
                    <div class="panel-body">

                        <!-- Fake browser bar -->
                        <div class="well well-sm" style="background:#343a40;color:#f8f9fa;border-radius:4px;">
                            <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#ff5f57;"></span>
                            <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#febc2e;"></span>
                            <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#28c840;"></span>
                            <span class="text-danger" style="margin-left:10px;">Not secure</span>
                            <span style="margin-left:10px;padding:3px 8px;background:#495057;border-radius:4px;font-family:monospace;">
                                http://hr-acmecorp-pay.com/login
                            </span>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-body">
                                <div class="text-center m-b-md">
                                    <div style="width:52px;height:52px;border-radius:12px;background:#337ab7;
                                                display:inline-flex;align-items:center;justify-content:center;
                                                color:#fff;font-size:24px;font-weight:bold;">
                                        H
                                    </div>
                                    <h4>Acme HR Portal</h4>
                                    <p class="text-muted">Sign in with your corporate credentials</p>
                                </div>

                                <form id="cloneLoginForm">
                                    <div class="form-group">
                                        <label for="email">Corporate Email</label>
                                        <input type="email" class="form-control" id="email" placeholder="you@acmecorp.com" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="password">Password</label>
                                        <input type="password" class="form-control" id="password" placeholder="Enter your password" required>
                                    </div>
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox"> Remember me
                                        </label>
                                        <a href="#" class="pull-right small">Forgot password?</a>
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-block">Sign In</button>
                                </form>

                                <p class="small text-muted m-t-md">
                                    Note: This is a training environment. No real credentials are stored.
                                </p>

                                <div id="training-result" class="alert alert-info m-t-md" style="display:none;">
                                    <strong>Training Message:</strong><br>
                                    This was a cloned phishing page used for awareness.<br>
                                    Suggested flag:
                                    <code>FLAG{credentials-captured-safely}</code>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden HTML comment flag (visible only in View Source) -->
                        <!-- training_flag = FLAG{cloned-website-found} -->
                    </div>
                </div>
            </div>

            <!-- Task / Flag panel -->
            <div class="col-lg-5">
                <div class="panel panel-info">
                    <div class="panel-heading"><strong>Task Panel – Step 2</strong></div>
                    <div class="panel-body">
                        <!-- Task 2 -->
                        <p><strong>Task 2 – Inspect the URL</strong></p>
                        <p class="small">
                            Check the domain shown in the fake browser bar above.
                            Compare it with the real company domain <code>acmecorp.com</code>.
                        </p>
                        <p class="small">
                            Suggested flag:
                            <code>FLAG{hr-acmecorp-pay.com}</code>
                        </p>
                        <div class="form-inline m-b-sm">
                            <input type="text" class="form-control input-sm lab-flag-input" id="flagDomain"
                                   placeholder="Enter domain flag">
                            <button type="button" class="btn btn-default btn-sm"
                                    onclick="checkFlag('flagDomain')">Check</button>
                            <span class="label label-success" id="flagDomainOk" style="display:none;margin-left:6px;">Correct</span>
                            <span class="label label-danger" id="flagDomainErr" style="display:none;margin-left:6px;">Try again</span>
                        </div>
                        <hr>

                        <!-- Task 3 -->
                        <p><strong>Task 3 – Hidden HTML Comment</strong></p>
                        <p class="small">
                            Right-click → <em>View page source</em> and search for <code>training_flag</code>.
                            You will find a hidden flag in an HTML comment.
                        </p>
                        <p class="small">
                            Example flag:
                            <code>FLAG{cloned-website-found}</code>
                        </p>
                        <div class="form-inline m-b-sm">
                            <input type="text" class="form-control input-sm lab-flag-input" id="flagHidden"
                                   placeholder="Enter hidden flag">
                            <button type="button" class="btn btn-default btn-sm"
                                    onclick="checkFlag('flagHidden')">Check</button>
                            <span class="label label-success" id="flagHiddenOk" style="display:none;margin-left:6px;">Correct</span>
                            <span class="label label-danger" id="flagHiddenErr" style="display:none;margin-left:6px;">Try again</span>
                        </div>
                        <hr>

                        <!-- Task 4 -->
                        <p><strong>Task 4 – Credential Submission</strong></p>
                        <p class="small">
                            Enter any dummy email and password and submit the form.
                            Read the training message to obtain the final flag.
                        </p>
                        <p class="small">
                            Example flag:
                            <code>FLAG{credentials-captured-safely}</code>
                        </p>
                        <div class="form-inline m-b-sm">
                            <input type="text" class="form-control input-sm lab-flag-input" id="flagCreds"
                                   placeholder="Enter final flag">
                            <button type="button" class="btn btn-default btn-sm"
                                    onclick="checkFlag('flagCreds')">Check</button>
                            <span class="label label-success" id="flagCredsOk" style="display:none;margin-left:6px;">Correct</span>
                            <span class="label label-danger" id="flagCredsErr" style="display:none;margin-left:6px;">Try again</span>
                        </div>

                        <hr>
                        <p><strong>Lab Progress</strong></p>
                        <p class="small">
                            Flags found:
                            <span id="labProgressCount">0</span> / 3
                        </p>
                        <div id="labCompletedBox" class="alert alert-success" style="display:none;">
                            <strong>Well done!</strong> You have completed Lab 1 – Clone Phishing.
                            Final completion flag:
                            <code>FLAG{clone-phishing-lab-completed}</code>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{{end}}

{{define "scripts"}}
<script>
// Hard-coded correct flags for this lab
var flagAnswers = {
    flagDomain: "FLAG{hr-acmecorp-pay.com}",
    flagHidden: "FLAG{cloned-website-found}",
    flagCreds:  "FLAG{credentials-captured-safely}"
};

var flagStatus = {
    flagDomain: false,
    flagHidden: false,
    flagCreds:  false
};

// Switch from email view to login view
document.addEventListener("DOMContentLoaded", function () {
    var openCloneBtn   = document.getElementById("openCloneBtn");
    var emailScreen    = document.getElementById("lab-email-screen");
    var loginScreen    = document.getElementById("lab-login-screen");
    var cloneForm      = document.getElementById("cloneLoginForm");
    var trainingResult = document.getElementById("training-result");

    if (openCloneBtn) {
        openCloneBtn.addEventListener("click", function () {
            emailScreen.style.display = "none";
            loginScreen.style.display = "block";
            window.scrollTo({ top: 0, behavior: "smooth" });
        });
    }

    if (cloneForm) {
        cloneForm.addEventListener("submit", function (e) {
            e.preventDefault();
            var email    = document.getElementById("email").value.trim();
            var password = document.getElementById("password").value.trim();

            if (email && password) {
                trainingResult.style.display = "block";
                trainingResult.scrollIntoView({ behavior: "smooth", block: "center" });
            }
        });
    }
});

// Generic flag checker
function checkFlag(flagId) {
    var input     = document.getElementById(flagId);
    var okLabel   = document.getElementById(flagId + "Ok");
    var errLabel  = document.getElementById(flagId + "Err");
    var expected  = flagAnswers[flagId];

    if (!input || !okLabel || !errLabel || !expected) {
        return;
    }

    var value = input.value.trim();

    if (value === expected) {
        okLabel.style.display  = "inline-block";
        errLabel.style.display = "none";
        flagStatus[flagId]     = true;
    } else {
        okLabel.style.display  = "none";
        errLabel.style.display = "inline-block";
        flagStatus[flagId]     = false;
    }

    updateLabProgress();
}

// Update progress + completion box
function updateLabProgress() {
    var count = 0;
    Object.keys(flagStatus).forEach(function (k) {
        if (flagStatus[k]) {
            count++;
        }
    });

    var counter = document.getElementById("labProgressCount");
    if (counter) {
        counter.textContent = count.toString();
    }

    var completeBox = document.getElementById("labCompletedBox");
    if (completeBox) {
        if (count === 3) {
            completeBox.style.display = "block";
        } else {
            completeBox.style.display = "none";
        }
    }
}
</script>
{{end}}
